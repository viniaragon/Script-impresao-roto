<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoLink â€” Laudos de Ultrasonografia com IA</title>
    <meta name="description"
        content="Sistema de automaÃ§Ã£o de laudos de ultrasonografia impulsionado por inteligÃªncia artificial.">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ©º</text></svg>">
</head>

<body>

    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header__brand">
                <span class="header__logo">ğŸ©º</span>
                <div>
                    <h1 class="header__title">EcoLink</h1>
                    <p class="header__subtitle">Laudos de Ultrasonografia com IA</p>
                </div>
            </div>
            <div class="header__actions">
                <!-- Provider Indicator -->
                <div class="provider-bar" id="provider-bar">
                    <span class="provider-badge" id="provider-badge">
                        ğŸ”— OpenRouter
                    </span>
                    <button class="btn btn--accent" id="btn-chatgpt-login" title="Conectar token do Codex CLI">
                        ğŸ¤– Conectar ChatGPT
                    </button>
                    <button class="btn btn--ghost btn--sm" id="btn-chatgpt-logout" style="display:none"
                        title="Sair do ChatGPT">
                        â†©ï¸ Sair
                    </button>
                </div>
                <div style="display: flex; gap: var(--space-sm); align-items: center;">
                    <button class="btn btn--accent" id="btn-voice-mode" title="Ativar modo de comando por voz">
                        ğŸ§ Modo Voz
                    </button>
                    <span class="voice-status" id="voice-status"
                        style="display:none; font-size: 0.8rem; color: var(--text-muted);">
                        â— Idle
                    </span>
                    <button class="btn btn--ghost" id="btn-settings" title="ConfiguraÃ§Ãµes de exportaÃ§Ã£o">
                        âš™ï¸
                    </button>
                    <button class="btn btn--ghost" id="btn-history" title="HistÃ³rico de laudos">
                        ğŸ“‹ HistÃ³rico
                    </button>
                </div>
        </header>

        <!-- Main Grid: Input | Output -->
        <div class="main-grid">

            <!-- LEFT PANEL: Dictation Input -->
            <div class="panel" id="panel-input">
                <div class="panel__header">
                    <span class="panel__title">ğŸ¤ Ditado MÃ©dico</span>
                    <span class="status status--ready" id="input-status">â— Pronto</span>
                </div>
                <div class="panel__body">
                    <!-- Patient Name (optional) -->
                    <div style="margin-bottom: var(--space-md);">
                        <div class="patient-input-group">
                            <input type="text" id="patientName" placeholder="Nome do paciente (opcional)"
                                autocomplete="off">
                            <button id="retryAudioBtn" class="record-btn" title="Reenviar Ã¡udio salvo"
                                style="display:none; background: var(--error-color); color: #fff;">
                                <span class="icon">ğŸ”„</span>
                                <span class="text">Reenviar</span>
                            </button>
                            <button id="recordBtn" class="record-btn" title="Ditar laudo por voz">
                                <span class="icon">ğŸ¤</span>
                                <span class="text">Ditar</span>
                            </button>
                        </div>
                    </div>

                    <!-- Dictation Textarea -->
                    <textarea class="dictation-area" id="dictation-input"
                        placeholder="Digite ou cole o ditado do exame aqui...&#10;&#10;Exemplo: Ultrassonografia do abdÃ´men. FÃ­gado apresentando alteraÃ§Ãµes compatÃ­veis com cirrose incipiente. Rim direito medindo 7,0 cm..."
                        spellcheck="true"></textarea>
                </div>
                <div class="panel__footer">
                    <span class="shortcut-hint"><kbd>Ctrl</kbd> + <kbd>Enter</kbd> para gerar</span>
                    <button class="btn btn--primary btn--lg" id="btn-generate">
                        âœ¨ Gerar Laudo
                    </button>
                </div>
            </div>

            <!-- RIGHT PANEL: Report Output -->
            <div class="panel" id="panel-output">
                <div class="panel__header">
                    <span class="panel__title">ğŸ“„ Laudo Gerado</span>
                    <div style="display: flex; gap: var(--space-sm); align-items: center;">
                        <span class="token-info" id="token-info"></span>
                    </div>
                </div>
                <div class="panel__body">
                    <div class="report-output empty" id="report-output" contenteditable="false">O laudo gerado aparecerÃ¡
                        aqui...</div>

                    <!-- Refine Area -->
                    <div class="refine-area" id="refine-area">
                        <input type="text" class="refine-input" id="refine-input"
                            placeholder="InstruÃ§Ãµes de ajuste... (ex: 'trocar medida do rim direito para 8,0')">
                        <button class="btn btn--secondary" id="btn-refine">ğŸ”„ Ajustar</button>
                    </div>
                </div>
                <div class="panel__footer">
                    <div style="display:flex; gap: var(--space-sm);">
                        <button class="btn btn--ghost" id="btn-copy" disabled title="Copiar laudo">ğŸ“‹ Copiar</button>
                        <button class="btn btn--ghost" id="btn-edit-toggle" disabled title="Editar laudo">âœï¸
                            Editar</button>
                        <button class="btn btn--accent" id="btn-download-word" disabled style="display:none;"
                            title="Baixar documento Word">ğŸ“„ Baixar Word</button>
                    </div>
                    <button class="btn btn--ghost" id="btn-new" title="Novo laudo">ğŸ—‘ï¸ Limpar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- History Panel -->
    <div class="overlay" id="overlay"></div>
    <div class="history-panel" id="history-panel">
        <div class="history-panel__header">
            <span class="panel__title">ğŸ“‹ HistÃ³rico de Laudos</span>
            <div style="display: flex; gap: var(--space-sm);">
                <button class="btn btn--ghost" id="btn-clear-history"
                    style="color: var(--error-color); font-size: 0.75rem;">ğŸ—‘ï¸ Limpar Tudo</button>
                <button class="btn btn--ghost" id="btn-close-history">âœ•</button>
            </div>
        </div>
        <div class="history-panel__body" id="history-list">
            <!-- Populated by JS -->
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="overlay" id="settings-overlay" style="display:none;"></div>
    <div class="settings-modal" id="settings-modal" style="display:none;">
        <div class="settings-modal__header">
            <span class="panel__title">âš™ï¸ ConfiguraÃ§Ãµes de ExportaÃ§Ã£o</span>
            <button class="btn btn--ghost" id="btn-close-settings">âœ•</button>
        </div>
        <div class="settings-modal__body" style="padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem;">
            <div>
                <label style="font-weight: bold; color: var(--text-primary); display: block; margin-bottom: 0.4rem;">ğŸ“„
                    Pasta para arquivos Word (.docx):</label>
                <input type="text" id="settings-docx-path" class="refine-input" placeholder="Ex: C:\Laudos\Word"
                    style="width: 100%;">
            </div>
            <div>
                <label style="font-weight: bold; color: var(--text-primary); display: block; margin-bottom: 0.4rem;">ğŸ“‘
                    Pasta para arquivos PDF (.pdf):</label>
                <input type="text" id="settings-pdf-path" class="refine-input" placeholder="Ex: C:\Laudos\PDF"
                    style="width: 100%;">
            </div>
            <p style="font-size: 0.8rem; color: var(--text-muted);">
                ğŸ’¡ Os laudos serÃ£o salvos automaticamente nestas pastas ao usar o comando de voz "eco gerar". Se deixar
                vazio, a exportaÃ§Ã£o automÃ¡tica serÃ¡ desativada.
            </p>
            <button class="btn btn--accent" id="btn-save-settings" style="align-self: flex-end;">ğŸ’¾ Salvar
                ConfiguraÃ§Ãµes</button>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <script src="audio-backup.js"></script>
    <script src="app.js"></script>
</body>

</html>